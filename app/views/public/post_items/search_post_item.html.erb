<div class="body">
  <div class= "post_form"><%= render 'public/post_items/post_form', post_item: @post_item %></div>
  <div class="container">
    <h3 class="h3">検索結果</h3>
    <!--投稿一覧を表示するeach文です-->
    <% @post_items.each do |post_item| %>
      <div class="box">
        <div><span>商品名：<%= post_item.title %></span>　<span><%= link_to post_item.customer.name, customer_path(post_item.customer_id) %></span></div>
        <%= link_to post_item_path(post_item.id) do %>
          <%= attachment_image_tag post_item, :image, :fill, 250, 150 %>
        <% end %>
        <p>衝動ポイント<br><%= (post_item.caption).truncate(29) %></p>
        <p>価格：<%= post_item.price %>円</p>
        <p><%= link_to "衝動リンク", post_item.url %></p>
        <p>
          <%= link_to "#{post_item.post_comments.count} コメント", post_item_path(post_item.id) %>
          <%= post_item.favorites.count %> いいね
        </p>
        <div class="impressions">
          <span>閲覧数：<%=  post_item.impressionist_count %></span>
          <% if customer_signed_in? %>
            <% if post_item.customer_id == current_customer.id %>
              <span><%= link_to "削除する", post_item_path(post_item), method: :delete %></span>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <div class="container2">
    <h3 class="h3">ランキング</h3>
    <table class="ranking">
      <thead>
        <tr><th colspan= "4">いいねランキング</th></tr>
        <% @favorite_ranks.each_with_index do |favorite_rank,i| %>
          <tr>
            <th><%= i + 1 %>位</th>
            <td>
              <%= link_to post_item_path(favorite_rank.id) do %>
                <%= attachment_image_tag favorite_rank, :image, :fill, 60, 50 %>
              <% end %>
            </td>
            <td>
              <%= link_to favorite_rank.title, post_item_path(favorite_rank.id) %>
            </td>
            <td>
              <%= favorite_rank.favorites.count %> いいね
            </td>
          </tr>
        <% end %>
      </thead>
    </table>

    <table class="ranking">
      <thead>
        <tr><th colspan= "4">コメント数ランキング</th></tr>
        <% @comment_ranks.each_with_index do |comment_rank,i| %>
          <tr>
            <th><%= i + 1 %>位</th>
            <td>
              <%= link_to post_item_path(comment_rank.id) do %>
                <%= attachment_image_tag comment_rank, :image, :fill, 60, 50 %>
              <% end %>
            </td>
            <td>
              <%= link_to comment_rank.title, post_item_path(comment_rank.id) %>
            </td>
            <td>
              <%= comment_rank.post_comments.count %> コメント
            </td>
          </tr>
        <% end %>
      </thead>
    </table>

    <table class="ranking">
      <thead>
        <tr><th colspan= "4">閲覧数ランキング</th></tr>
        <% @impression_ranks.each_with_index do |impression_rank,i| %>
          <tr>
            <th><%= i + 1 %>位</th>
            <td>
              <%= link_to post_item_path(impression_rank.id) do %>
                <%= attachment_image_tag impression_rank, :image, :fill, 60, 50 %>
              <% end %>
            </td>
            <td>
              <%= link_to impression_rank.title, post_item_path(impression_rank.id) %>
            </td>
            <td>
              <%= impression_rank.impressionist_count %>回
            </td>
          </tr>
        <% end %>
      </thead>
    </table>
  </div>
</div>